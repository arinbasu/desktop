<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>Stencila Desktop</title>
  <link href="../node_modules/stencila/build/stencila.css" rel="stylesheet" type="text/css">
  <script type="text/javascript" src="../node_modules/stencila/build/web/substance.js"></script>
  <script type="text/javascript" src="../node_modules/stencila/build/web/substance-mini.js"></script>
  <script type="text/javascript" src="../node_modules/stencila/build/web/brace.min.js"></script>
  <script type="text/javascript" src="../node_modules/stencila/build/katex/katex.min.js"></script>
  <script type="text/javascript" src="../node_modules/stencila/build/stencila.js"></script>
  <script>
    const { MemoryBackend, Dashboard } = window.stencila
    const { Component } = window.substance
    const stubBackend = new MemoryBackend()
    const ipc = require('electron').ipcRenderer
    const windowId = require('electron').remote.getCurrentWindow().id


    class MyButton extends Component {
      constructor(...args) {
        super(...args)
      }
      render($$) {
        return $$('div').append(
          $$('button').text('Foo')
            .on('click', () => {
              console.log('FOO')
              ipc.send('updateAppState', {
                windowId: windowId,
                data: 'foo'
              })
            }),
          $$('button').text('Bar')
            .on('click', () => {
              console.log('BAR')
              ipc.send('updateAppState', {
                windowId: windowId,
                data: 'bar'
              })
            })
        )
      }
    }

    window.addEventListener('load', () => {
      Dashboard.mount({
        backend: stubBackend,
        resolveEditorURL: function(type, archiveURL) {
          let editorURL
          if (type === 'document') {
            editorURL = "document.html"
          } else {
            editorURL = "sheet.html"
          }
          editorURL += '?archiveURL='+encodeURIComponent(archiveURL)
          return editorURL
        }
      }, window.document.getElementById('dashboard'))
      MyButton.mount(window.document.getElementById('buttons'))
    })
  </script>
</head>
<body>
  <div id='buttons'></div>
  <div id='dashboard'></div>
</body>
</html>
